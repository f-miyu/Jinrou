# 説明

## gRPCによる双方向通信
双方向通信を実現するために、gRPCを採用しました。自動でコード生成も行われるので、簡単に実装することができました。
最初Xamarinではうまく苦労しましたが、最終的に動かすことができました。

## クリーンアーキテクチャによる実装
サーバー、クライアントともにクリーンアーキテクチャに則って実装しています。domain、usecase、dataの３つの層にわけ、domain層では、人狼ゲームのコアロジックを、
usecase層では、トランザクションなどのアプリケーション処理を、data層では、DBや通信処理を行う様にしています。テストもしやすいコードになっていると思います。

## 認証機能
JWTによる認証を実装しています。１時間で有効期限が切れるアクセストークンと期限のないリフレッシュトークンを発行して、毎回のAPI呼び出し時にアクセストークンも送るようにしています。
アクセストークンの有効期限が切れた場合には、リフレッシュトークンを送って、新しいアクセストークンを発行するようにしています。
リフレッシュトークンのIDは、データベースに保存して、有効確認も行っています。
クライアントのモバイルアプリでは、これらのトークンをキーチェーンやキーストアで保存する様にしています。

## コンソールアプリとXamarin.Formsアプリ
クリーンアーキテクチャによって、フレームワークに依らない実装になっているので、コアの処理はそのままで、２つ実装することができました。
ただ、コンソールでのRxでの非同期処理が、待つ前の昔の値が流れてくるといった謎の挙動に苦しめられましたが、Publishすることがなんとか解決することができました。

## C#9の機能
先日リリースされたばかりの、C#9の機能を試しに使ってみました。record型のおかげで、イミュータブルなデータが作りやすくなったので、今後もよく使うことになると思います。
